# Epistory - GitHub Issues

## MVP Issue一覧（依存順・完了済み）

| # | タイトル | 依存 |
|---|---------|------|
| 4 | Docker開発環境のセットアップ | なし |
| 6 | Renderデプロイ設定 | #4 |
| 5 | Tailwind CSS・Hotwireの導入と基本レイアウト作成 | #6 |
| 7 | マスターテーブルのモデル・マイグレーション作成 | #4 |
| 8 | シードデータの投入 | #7 |
| 9 | messagesテーブル・message_impressionsテーブルのモデル作成 | #7 |
| 10 | メッセージ生成ロジック（テンプレートエンジン）の実装 | #8, #9 |
| 11 | ステップフォーム（Step 1〜3）の実装 | #5, #8 |
| 12 | ステップフォーム（Step 4〜6）の実装 | #10, #11 |
| 13 | メッセージ表示画面の実装 | #12 |
| 14 | メッセージ編集機能の実装 | #13 |
| 15 | クリップボードコピー機能の実装 | #13 |
| 16 | 入力バリデーションとエラー表示の実装 | #12 |
| 17 | トップページのUI実装 | #5 |
| 18 | E2Eテスト・最終動作確認 | #15, #16, #17 |

### 本リリース向けIssue

| # | タイトル | 依存 |
|---|---------|------|
| 40 | メッセージ生成ロジックの改善 | なし |
| 41 | メッセージ再生成機能 | #40 |
| 42 | ユーザー認証機能（GitHub OAuth） | なし |
| 43 | Googleログイン（OAuth） | #42 |
| 44 | メッセージ履歴の保存・マイページ | #42 |
| 45 | AIによる表現調整機能（Claude API） | #40 |
| 46 | 文体・トーン切り替え機能 | #45 |
| 47 | 画像出力機能 | なし |
| 48 | SNS・LINEシェア機能 | なし |
| 49 | 利用規約ページの作成 | なし |
| 50 | プライバシーポリシーページの作成 | なし |
| 51 | お問い合わせ機能の実装 | なし |

---

## Issue #4: Docker開発環境のセットアップ

### 概要
Docker ComposeでRails 7.0.8 + PostgreSQLの開発環境を構築する。全開発の基盤となるIssue。

### やること
- [x] `Dockerfile` の作成（Ruby 3.2ベース）
- [x] `docker-compose.yml` の作成（web + db サービス）
- [x] `Gemfile` / `Gemfile.lock` の作成
- [x] `rails new` でRails 7.0.8アプリを生成（`--database=postgresql --css=tailwind --skip-jbuilder`）
- [x] `database.yml` のDocker用設定
- [x] `entrypoint.sh` の作成（server.pidの削除処理）
- [x] `.env` / `.env.example` の作成
- [x] `.dockerignore` の作成
- [x] `docker compose up` でRailsのウェルカムページが表示されることを確認

### 完了条件
- `docker compose build` がエラーなく完了する
- `docker compose up` でRailsサーバーが起動し、`localhost:3000` でウェルカムページが表示される
- `docker compose exec web rails db:create` が成功する

### 依存Issue
- なし

---

## Issue #6: Renderデプロイ設定

### 概要
`rails new`直後の状態で、CSSなどが当たっていない仮のTOPページを作成し、Renderにデプロイする。早期にデプロイ環境を整え、以降の開発で継続的にデプロイ確認できるようにする。

### やること
- [x] 仮のTOPページ用コントローラー（`PagesController`）とアクション（`home`）を作成
- [x] 仮のTOPページ用ビュー（`app/views/pages/home.html.erb`）を作成（シンプルなテキストのみ表示）
- [x] ルーティング設定（`root "pages#home"`）
- [x] ローカル環境で仮のTOPページが表示されることを確認
- [x] `render.yaml`（Blueprint）の作成、またはRenderダッシュボードでの設定
- [x] `bin/render-build.sh` の作成（ビルドスクリプト）
  - `bundle install`
  - `rails assets:precompile`
  - `rails db:migrate`
- [x] 本番環境用の環境変数設定（`RAILS_MASTER_KEY`, `DATABASE_URL` 等）
- [x] `config/environments/production.rb` の確認・調整
- [x] `config/puma.rb` の本番設定確認
- [x] Render PostgreSQLデータベースの作成
- [x] 初回デプロイの実行と動作確認

### 完了条件
- ローカル環境で `localhost:3000` にアクセスすると仮のTOPページ（テキストのみ）が表示される
- Renderへのデプロイが成功する
- 本番環境でも仮のTOPページ（テキストのみ）が表示される

### 依存Issue
- #4 Docker開発環境のセットアップ

---

## Issue #5: Tailwind CSS・Hotwireの導入と基本レイアウト作成

### 概要
Tailwind CSSとHotwire（Turbo/Stimulus）を導入し、アプリケーション共通のレイアウトファイルを整備する。

### やること
- [x] Tailwind CSSの動作確認（`rails new`時に`--css=tailwind`で導入済みの場合は設定確認）
- [x] `turbo-rails`、`stimulus-rails` の動作確認
- [x] `app/views/layouts/application.html.erb` にヘッダー・フッター・メインコンテンツ領域を作成
- [x] レスポンシブ対応の基本スタイル設定
- [x] `app/assets/stylesheets/` にカスタムスタイルの基盤ファイルを作成（必要に応じて）
- [x] トップページ用の静的コントローラー（`PagesController#home`）とビューを作成
- [x] ルーティング設定（`root` を `pages#home` に設定）

### 完了条件
- Tailwind CSSのクラスがビューで適用されている
- Turbo Driveによるページ遷移が動作する
- `localhost:3000` でトップページ（ヘッダー・フッター付き）が表示される
- モバイル・デスクトップの両方でレイアウトが崩れない

### 依存Issue
- #6 Renderデプロイ設定

---

## Issue #7: マスターテーブルのモデル・マイグレーション作成

### 概要
質問フォームの選択肢となるマスターデータ（recipients, occasions, impressions, feelings）のテーブルとモデルを作成する。

### やること
- [x] `recipients` テーブルのマイグレーション作成（name:string, position:integer）
- [x] `occasions` テーブルのマイグレーション作成（name:string, position:integer）
- [x] `impressions` テーブルのマイグレーション作成（name:string, position:integer）
- [x] `feelings` テーブルのマイグレーション作成（name:string, position:integer）
- [x] 各モデルファイルの作成（`Recipient`, `Occasion`, `Impression`, `Feeling`）
- [x] バリデーション追加（name: presence, position: presence + numericality）
- [x] `default_scope { order(position: :asc) }` の設定
- [x] モデルのユニットテスト作成

### 完了条件
- `rails db:migrate` が成功する
- 各モデルのバリデーションが正しく動作する（テストで確認）
- `rails console` でレコードの作成・取得ができる

### 依存Issue
- #4 Docker開発環境のセットアップ

---

## Issue #8: シードデータの投入

### 概要
マスターテーブルにMVPで使用する選択肢データを投入する。

### やること
- [x] `db/seeds.rb` にrecipientsデータを追加（親, パートナー, 友人, 兄弟・姉妹, 祖父母, 職場の人, その他）
- [x] `db/seeds.rb` にoccasionsデータを追加（誕生日・記念日, 日頃の感謝, 最近助けてもらった, しばらく会えていない, 特別な理由はない, その他）
- [x] `db/seeds.rb` にimpressionsデータを追加（いつも支えてくれる, 一緒にいると安心する, 自分を理解してくれる, 困ったときに頼れる, 笑顔にしてくれる, 尊敬している, 刺激をもらえる）
- [x] `db/seeds.rb` にfeelingsデータを追加（ありがとう, これからもよろしく, いつも助かっている, 大切に思っている, ごめんね、そしてありがとう）
- [x] 冪等性を考慮した実装（`find_or_create_by` の使用）
- [x] `rails db:seed` の動作確認

### 完了条件
- `rails db:seed` がエラーなく完了する
- 各テーブルに正しいデータが投入されている
- `rails db:seed` を複数回実行してもデータが重複しない

### 依存Issue
- #7 マスターテーブルのモデル・マイグレーション作成

---

## Issue #9: messagesテーブル・message_impressionsテーブルのモデル作成

### 概要
ユーザーの回答結果と生成メッセージを保存するmessagesテーブル、および多対多の中間テーブル（message_impressions）を作成する。

### やること
- [x] `messages` テーブルのマイグレーション作成
  - user_id: bigint（nullable、外部キー）
  - recipient_id: bigint（外部キー、NOT NULL）
  - occasion_id: bigint（外部キー、NOT NULL）
  - feeling_id: bigint（外部キー、NOT NULL）
  - episode: text
  - additional_message: text（nullable）
  - generated_content: text
  - edited_content: text（nullable）
  - timestamps
- [x] `message_impressions` テーブルのマイグレーション作成（message_id, impression_id）
- [x] `Message` モデルの作成（アソシエーション・バリデーション）
- [x] `MessageImpression` モデルの作成
- [x] `has_many :message_impressions` / `has_many :impressions, through: :message_impressions` の設定
- [x] マスターモデル側に `has_many :messages` を追加
- [x] モデルのユニットテスト作成

### 完了条件
- `rails db:migrate` が成功する
- `Message` に必要なアソシエーションが正しく設定されている
- `message.impressions` で関連するimpressionsを取得できる
- バリデーションテストが通る（recipient_id, occasion_id, feeling_id の必須チェック）

### 依存Issue
- #7 マスターテーブルのモデル・マイグレーション作成

---

## Issue #10: メッセージ生成ロジック（テンプレートエンジン）の実装

### 概要
ユーザーの回答に基づいてメッセージを生成するサービスクラスを実装する。条件分岐によるテンプレートベースの文章生成ロジック。

### やること
- [x] `app/services/message_generator.rb` の作成
- [x] recipient（相手）に応じた呼称・敬称の分岐ロジック
- [x] occasion（きっかけ）に応じた導入文のテンプレート
- [x] impressions（印象・複数）を文章に組み込むロジック
- [x] episode（エピソード）を自然に挿入するロジック
- [x] feeling（気持ち）に応じた締めくくり文のテンプレート
- [x] additional_message（追加メッセージ）がある場合の挿入ロジック
- [x] 各条件分岐の組み合わせテスト
- [x] サービスクラスのユニットテスト作成（主要パターンを網羅）

### 完了条件
- `MessageGenerator.new(message).generate` で文章が生成される
- recipientとoccasionの組み合わせに応じて導入文が変化する
- impressionsが複数選択された場合に自然な文章になる
- episodeが文中に適切に組み込まれる
- feelingに応じた締めくくりが生成される
- additional_messageが任意で文末に追加される
- ユニットテストが全て通る

### 依存Issue
- #8 シードデータの投入
- #9 messagesテーブル・message_impressionsテーブルのモデル作成

---

## Issue #11: ステップフォーム（Step 1〜3）の実装 - 選択式質問

### 概要
メッセージ作成の前半3ステップ（相手選択・きっかけ選択・印象選択）のフォームUIをTurbo Framesを使って実装する。

### やること
- [x] `MessagesController` の作成（`new` / `step1` / `step2` / `step3` アクション）
- [x] ルーティング設定（ステップ遷移用）
- [x] Step 1: 相手を選ぶ画面（ラジオボタン形式）
- [x] Step 2: きっかけを選ぶ画面（ラジオボタン形式）
- [x] Step 3: 印象を選ぶ画面（チェックボックス形式・複数選択）
- [x] Turbo Framesによるステップ遷移の実装
- [x] 進捗バー（プログレスインジケーター）の表示
- [x] セッションまたはhidden fieldsによる回答の一時保持
- [x] 「戻る」ボタンによる前ステップへの遷移
- [x] Tailwind CSSによるスタイリング（カード形式の選択UI）

### 完了条件
- Step 1で相手を選択してStep 2に遷移できる
- Step 2できっかけを選択してStep 3に遷移できる
- Step 3で印象を複数選択できる
- 各ステップで「戻る」操作ができ、以前の選択が保持されている
- プログレスバーが現在のステップを反映している
- レスポンシブ対応されている

### 依存Issue
- #5 Tailwind CSS・Hotwireの導入と基本レイアウト作成
- #8 シードデータの投入

---

## Issue #12: ステップフォーム（Step 4〜6）の実装 - テキスト入力・確認

### 概要
メッセージ作成の後半3ステップ（エピソード入力・気持ち選択・追加メッセージ入力）とメッセージ生成処理を実装する。

### やること
- [x] `MessagesController` に `step4` / `step5` / `step6` / `create` アクションを追加
- [x] Step 4: エピソード入力画面（テキストエリア + ヒント例の表示）
- [x] Step 5: 気持ちを選ぶ画面（ラジオボタン形式）
- [x] Step 6: 追加メッセージ入力画面（テキストエリア + スキップボタン）
- [x] `create` アクションでの `Message` レコード保存処理
- [x] `MessageGenerator` を呼び出し `generated_content` に保存
- [x] 生成完了後の結果画面へのリダイレクト
- [x] Tailwind CSSによるスタイリング

### 完了条件
- Step 4でエピソードを自由記述できる（ヒント例が表示される）
- Step 5で気持ちを選択できる
- Step 6で追加メッセージを入力またはスキップできる
- 全ステップ完了後に `Message` レコードが正しく保存される
- `generated_content` にテンプレートベースで生成されたメッセージが保存される
- 生成完了後に結果画面に遷移する

### 依存Issue
- #10 メッセージ生成ロジック（テンプレートエンジン）の実装
- #11 ステップフォーム（Step 1〜3）の実装

---

## Issue #13: メッセージ表示画面の実装

### 概要
生成されたメッセージを表示する画面を実装する。ここからメッセージの編集やコピーへ遷移できる。

### やること
- [x] `MessagesController#show` アクションの実装
- [x] メッセージ表示ビュー（`app/views/messages/show.html.erb`）の作成
- [x] 生成されたメッセージの表示（`edited_content` があればそちらを優先表示）
- [x] 「編集する」ボタンの配置
- [x] 「コピーする」ボタンの配置
- [x] 「新しいメッセージを作る」リンクの配置
- [x] メッセージの表示フォーマット整備（改行の反映など）
- [x] Tailwind CSSによるスタイリング（手紙風デザイン等）

### 完了条件
- `/messages/:id` でメッセージが正しく表示される
- `edited_content` が存在する場合はそちらが優先表示される
- 「編集する」「コピーする」「新しいメッセージを作る」のボタン/リンクが表示される
- メッセージ内の改行が正しく反映される

### 依存Issue
- #12 ステップフォーム（Step 4〜6）の実装

---

## Issue #14: メッセージ編集機能の実装

### 概要
生成されたメッセージをユーザーが自由に編集できる機能を実装する。編集内容は `edited_content` カラムに保存する。

### やること
- [x] `MessagesController#edit` アクションの実装
- [x] `MessagesController#update` アクションの実装
- [x] 編集フォームビュー（`app/views/messages/edit.html.erb`）の作成
- [x] テキストエリアに現在のメッセージ内容をプリセット（`edited_content || generated_content`）
- [x] 「元に戻す」ボタン（`generated_content` に戻す機能）
- [x] 保存成功時にshow画面へリダイレクト
- [x] Tailwind CSSによるスタイリング

### 完了条件
- 編集画面でメッセージを自由に変更できる
- 保存後に `edited_content` が更新される
- 「元に戻す」で `generated_content` の内容に復元できる
- 保存後にshow画面にリダイレクトされ、更新された内容が表示される

### 依存Issue
- #13 メッセージ表示画面の実装

---

## Issue #15: クリップボードコピー機能の実装

### 概要
メッセージをクリップボードにコピーする機能をStimulus Controllerで実装する。

### やること
- [x] `app/javascript/controllers/clipboard_controller.js` の作成
- [x] Clipboard API（`navigator.clipboard.writeText`）を使用したコピー処理
- [x] コピー成功時のフィードバックUI（トースト通知 or ボタンテキスト変更）
- [x] Clipboard API非対応ブラウザのフォールバック処理（`document.execCommand('copy')`）
- [x] show画面のコピーボタンにStimulus Controllerを接続
- [x] コピー対象テキストの取得ロジック（`edited_content || generated_content`）

### 完了条件
- 「コピーする」ボタンをクリックするとメッセージがクリップボードにコピーされる
- コピー成功時にフィードバック（「コピーしました！」等）が表示される
- フィードバックが一定時間後に元に戻る
- コピー内容がペースト時に正しく反映される

### 依存Issue
- #13 メッセージ表示画面の実装

---

## Issue #16: 入力バリデーションとエラー表示の実装

### 概要
各ステップのフォームにクライアントサイド・サーバーサイド両方のバリデーションを追加し、エラーメッセージをユーザーフレンドリーに表示する。

### やること
- [x] Messageモデルのバリデーション強化（エラーメッセージの日本語化）
- [x] `config/locales/ja.yml` の作成（ActiveRecordエラーメッセージの日本語化）
- [x] `config/application.rb` でデフォルトロケールを `:ja` に設定
- [x] Step 1〜3: 未選択時のエラーメッセージ表示
- [x] Step 3: 最低1つ選択必須のバリデーション
- [x] Step 4: エピソード未入力時のエラーメッセージ表示
- [x] Step 4: エピソードの文字数制限（上限設定）
- [x] Step 6: additional_messageの文字数制限（上限設定、任意入力）
- [x] Stimulus Controllerによるリアルタイムバリデーション（文字数カウンター等）
- [x] エラー表示のスタイリング（赤文字・ボーダー変更等）

### 完了条件
- 必須項目が未入力の場合、次のステップに進めずエラーメッセージが表示される
- エラーメッセージが日本語で表示される
- 文字数カウンターがリアルタイムで更新される
- 文字数超過時に警告が表示される
- サーバーサイドバリデーションもエラー時に適切なメッセージを返す

### 依存Issue
- #12 ステップフォーム（Step 4〜6）の実装

---

## Issue #17: トップページのUI実装

### 概要
サービスの概要とメッセージ作成開始ボタンを配置したトップページを作成する。

### やること
- [x] トップページのヒーローセクション（キャッチコピー + CTA）
- [x] サービス説明セクション（使い方3ステップ等）
- [x] 「メッセージを作る」ボタン（メッセージ作成フォームへのリンク）
- [x] レスポンシブ対応
- [x] Tailwind CSSによるスタイリング

### 完了条件
- トップページにサービスの概要が分かりやすく表示される
- 「メッセージを作る」ボタンからStep 1に遷移できる
- モバイル・デスクトップの両方で見やすいレイアウトになっている

### 依存Issue
- #5 Tailwind CSS・Hotwireの導入と基本レイアウト作成

---

## Issue #18: E2Eテスト・最終動作確認

### 概要
MVP機能全体のシステムテスト（E2E）を作成し、本番環境での最終動作確認を行う。

### やること
- [x] System Test用のセットアップ（Capybara + Selenium/Cuprite）
- [x] メッセージ作成フロー全体のE2Eテスト（Step 1〜6 + 生成）
- [x] メッセージ編集フローのE2Eテスト
- [x] バリデーションエラー表示のテスト
- [x] 本番環境での手動動作確認チェックリスト実施
- [x] パフォーマンス確認（ページ読み込み速度）
- [x] ブラウザ互換性確認（Chrome, Safari, Firefox）
- [x] モバイル表示確認

### 完了条件
- 全てのシステムテストがパスする
- 本番環境でメッセージ作成→表示→編集→コピーの一連フローが動作する
- 主要ブラウザで表示崩れがない
- モバイルでの操作に支障がない

### 依存Issue
- #15 クリップボードコピー機能の実装
- #16 入力バリデーションとエラー表示の実装
- #17 トップページのUI実装

---

## Issue #40: メッセージ生成ロジックの改善

### 概要
現状のテンプレートエンジンを改善し、生成メッセージの品質を向上させる。

### やること
- [ ] エピソード前後に導入文・まとめ文を追加し、文脈に統合する
- [ ] 印象ごとに1〜2文の描写テンプレートを用意し、単語列挙をやめる
- [ ] 各カテゴリに複数パターンのテンプレートを用意しバリエーションを出す
- [ ] 生成結果のユニットテスト更新

### 完了条件
- 同じ選択でも複数パターンのメッセージが生成される
- エピソードが前後の文脈と自然に繋がる
- 印象が具体的な描写文として表現される

### 依存Issue
- なし

---

## Issue #41: メッセージ再生成機能

### 概要
showページに「もう一度生成する」ボタンを追加し、同じ入力内容で別パターンのメッセージを生成できるようにする。

### やること
- [ ] showページに「もう一度生成する」ボタンを追加
- [ ] MessagesControllerにregenerateアクションを追加
- [ ] ルーティング追加（PATCH /messages/:id/regenerate）
- [ ] 生成ロジックでランダムパターンを選択する仕組み
- [ ] テスト作成

### 完了条件
- 「もう一度生成する」で別のメッセージが生成される
- edited_contentがある場合は確認ダイアログを表示する

### 依存Issue
- #40 メッセージ生成ロジックの改善

---

## Issue #42: ユーザー認証機能（GitHub OAuth）

### 概要
OmniAuth + GitHubによるOAuth認証を導入する。パスワード管理不要のシンプルな認証。未ログインでも1回目のメッセージ作成は可能。2回目以降はログインを促す。

### やること
- [ ] omniauth-github gem・omniauth-rails_csrf_protection gemの導入
- [ ] Userモデルの作成（provider, uid, name, avatar_url, email等）
- [ ] GitHub OAuth Appの登録・Client ID / Secret の取得
- [ ] OmniAuthコールバック用コントローラーの実装
- [ ] セッション管理（ログイン/ログアウト）の実装
- [ ] ログイン画面の作成（「GitHubでログイン」ボタン）
- [ ] Tailwind CSSによるスタイリング
- [ ] セッションによる初回作成の管理（`session[:message_created]`）
- [ ] 2回目以降の作成時にログインを促すリダイレクト処理
- [ ] ログイン後に直前の手紙を`user_id`に紐付ける処理
- [ ] 本番環境（Render）の環境変数設定
- [ ] テスト作成

### 完了条件
- GitHubアカウントでログイン・新規登録ができる
- 未ログインで1回メッセージ作成ができる
- 2回目以降はログインを求められる
- ログイン後に直前の手紙がユーザーに紐付く
- ログアウトが動作する

### 依存Issue
- なし

---

## Issue #43: Googleログイン（OAuth）

### 概要
OmniAuth + Googleによるソーシャルログインを追加し、GitHub以外の認証手段を提供する。

### やること
- [ ] omniauth-google-oauth2 gemの導入
- [ ] Google Cloud ConsoleでOAuth2クライアントID取得
- [ ] OmniAuthコールバック処理にGoogle用の分岐を追加
- [ ] ログイン画面に「Googleでログイン」ボタンを追加
- [ ] 同一メールアドレスのGitHubユーザーとの紐付け処理
- [ ] 本番環境（Render）の環境変数設定
- [ ] テスト作成

### 完了条件
- Googleアカウントでログイン・新規登録ができる
- 同一メールアドレスのGitHubアカウントと紐付けされる

### 依存Issue
- #42 ユーザー認証機能（GitHub OAuth）

---

## Issue #44: メッセージ履歴の保存・マイページ

### 概要
ログインユーザーが過去に作成したメッセージの一覧を閲覧・管理できるマイページを実装する。

### やること
- [ ] マイページ（メッセージ一覧）のルーティング・コントローラー・ビュー作成
- [ ] メッセージ一覧の表示（作成日時、相手、きっかけ、冒頭テキスト）
- [ ] メッセージの削除機能
- [ ] ページネーション（kaminari等）
- [ ] 空状態の表示（メッセージがない場合のUI）
- [ ] テスト作成

### 完了条件
- マイページでメッセージ一覧が表示される
- 一覧からメッセージ詳細に遷移できる
- メッセージの削除ができる

### 依存Issue
- #42 ユーザー登録・ログイン機能（Devise）

---

## Issue #45: AIによる表現調整機能（Claude API）

### 概要
Claude APIを使用し、ユーザーの入力内容をもとに自然な手紙文を生成する機能を追加する。テンプレート生成とAI生成を選択できるようにする。

### やること
- [ ] Claude API（Anthropic SDK）の導入・設定
- [ ] AIメッセージ生成サービスクラスの作成
- [ ] プロンプト設計（ユーザー入力をコンテキストとして渡す）
- [ ] showページにAI生成ボタンを追加（またはStep6完了時に選択）
- [ ] API呼び出しのエラーハンドリング・リトライ処理
- [ ] APIキーの環境変数管理
- [ ] テスト作成（APIモック使用）

### 完了条件
- Claude APIによる自然な文章が生成される
- API障害時にテンプレート生成へフォールバックする
- 生成中のローディング表示がある

### 依存Issue
- #40 メッセージ生成ロジックの改善

---

## Issue #46: 文体・トーン切り替え機能

### 概要
メッセージの文体（カジュアル / 丁寧 / フォーマル等）を選択できる機能を追加する。

### やること
- [ ] トーン選択UI（ステップフォームまたはshowページ）の追加
- [ ] AI生成時のプロンプトにトーン指定を反映
- [ ] テンプレート生成時のトーン別テンプレート（可能な範囲で）
- [ ] テスト作成

### 完了条件
- トーンを選択してメッセージの文体が変化する
- 少なくとも3種類のトーンから選択できる

### 依存Issue
- #45 AIによる表現調整機能（Claude API）

---

## Issue #47: 画像出力機能

### 概要
メッセージを画像（PNG/JPEG）として出力できる機能を実装する。手紙風のデザインで画像化し、SNSやメッセージアプリで共有しやすくする。

### やること
- [ ] 画像生成の技術選定（html2canvas等のJS、またはサーバーサイド生成）
- [ ] 手紙風デザインテンプレートの作成
- [ ] showページに「画像で保存」ボタンを追加
- [ ] 画像ダウンロード処理の実装
- [ ] モバイル対応
- [ ] テスト作成

### 完了条件
- メッセージを手紙風デザインの画像として保存できる
- ダウンロードした画像がSNS共有に適したサイズ・品質である

### 依存Issue
- なし

---

## Issue #48: SNS・LINEシェア機能

### 概要
メッセージをLINE・X（Twitter）などのSNSに直接シェアできるボタンを追加する。

### やること
- [ ] showページにLINEシェアボタンを追加（LINE URLスキーム）
- [ ] Xシェアボタンを追加
- [ ] OGP（Open Graph Protocol）メタタグの設定
- [ ] シェア用テキストの生成ロジック
- [ ] テスト作成

### 完了条件
- LINEアプリでメッセージをシェアできる
- Xにメッセージをシェアできる
- シェアリンクに適切なOGPプレビューが表示される

### 依存Issue
- なし

---

## Issue #49: 利用規約ページの作成

### 概要
利用規約ページを作成し、フッターからリンクする。

### やること
- [ ] StaticPagesController（またはPagesController）にtermsアクションを追加
- [ ] 利用規約の本文作成
- [ ] フッターに「利用規約」リンクを追加
- [ ] ルーティング設定

### 完了条件
- フッターから利用規約ページに遷移できる
- 利用規約の内容が表示される

### 依存Issue
- なし

---

## Issue #50: プライバシーポリシーページの作成

### 概要
プライバシーポリシーページを作成し、フッターからリンクする。

### やること
- [ ] PagesControllerにprivacyアクションを追加
- [ ] プライバシーポリシーの本文作成
- [ ] フッターに「プライバシーポリシー」リンクを追加
- [ ] ルーティング設定

### 完了条件
- フッターからプライバシーポリシーページに遷移できる
- プライバシーポリシーの内容が表示される

### 依存Issue
- なし

---

## Issue #51: お問い合わせ機能の実装

### 概要
お問い合わせフォームを作成し、フッターからリンクする。

### やること
- [ ] ContactsController・Contactモデル（またはメール送信のみ）の作成
- [ ] お問い合わせフォーム（名前・メールアドレス・内容）の作成
- [ ] バリデーション（必須項目・メール形式）
- [ ] 送信完了画面の作成
- [ ] Action Mailerによる通知メール送信
- [ ] フッターに「お問い合わせ」リンクを追加
- [ ] テスト作成

### 完了条件
- フッターからお問い合わせページに遷移できる
- フォーム送信後に完了画面が表示される
- 管理者にメール通知が届く

### 依存Issue
- なし

---

## 依存関係図

### MVP（完了済み）

```
#4 Docker環境
├── #6 デプロイ設定（仮TOPページ作成＋デプロイ）
│   └── #5 Tailwind/Hotwire/レイアウト
│       ├── #11 ステップフォーム(1-3)
│       │   └── #12 ステップフォーム(4-6)
│       │       ├── #13 メッセージ表示
│       │       │   ├── #14 メッセージ編集
│       │       │   └── #15 コピー機能
│       │       └── #16 バリデーション
│       └── #17 トップページUI
├── #7 マスターテーブル
│   ├── #8 シードデータ
│   │   ├── #10 メッセージ生成ロジック
│   │   └── #11 ステップフォーム(1-3)
│   └── #9 messages/message_impressions
│       └── #10 メッセージ生成ロジック
#18 E2Eテスト ← #15, #16, #17
```

### 本リリース

```
#40 メッセージ生成ロジック改善
├── #41 メッセージ再生成
└── #45 AI表現調整
    └── #46 文体・トーン切り替え

#42 ユーザー認証（GitHub OAuth）
├── #43 Googleログイン（OAuth）
└── #44 メッセージ履歴・マイページ

#47 画像出力           ← 独立
#48 SNS・LINEシェア    ← 独立
#49 利用規約           ← 独立
#50 プライバシーポリシー ← 独立
#51 お問い合わせ        ← 独立
```

## 並行作業可能な組み合わせ

### MVP（完了済み）
- #6 と #7（#4完了後）
- #5 と #8（#6と#7が完了後）
- #14 と #15（#13完了後）
- #16 と #17（それぞれの依存元完了後）

### 本リリース
- #40 と #42 と #47 と #48 と #49 と #50 と #51（全て独立、同時着手可能）
- #41 と #45（#40完了後）
- #43 と #44（#42完了後）
